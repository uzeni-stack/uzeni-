<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Finance - RoÄnÃ­ bilance a Zisk</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #1a237e; --money: #2e7d32; --loss: #d32f2f; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        .grid-prehled { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; }
        .box { padding: 20px; border-radius: 12px; text-align: center; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .box-trzby { background: var(--money); }
        .box-naklady { background: #546e7a; }
        .box-zisk { background: var(--primary); }
        .castka { font-size: 1.8rem; font-weight: 900; display: block; }

        .sekce { background: white; padding: 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .form-naklad { display: flex; gap: 10px; margin-bottom: 20px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .btn-add { background: var(--loss); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; background: #f8f9fa; padding: 12px; font-size: 0.8rem; color: #666; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .plus { color: var(--money); font-weight: bold; }
        .minus { color: var(--loss); font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0">ğŸ“Š FinanÄnÃ­ bilance</h2>
    <div>
        <select id="select-rok" onchange="nactiData()"><option value="2025">2025</option><option value="2026" selected>2026</option></select>
        <a href="admin.html" style="text-decoration:none; margin-left:15px; font-weight:bold;">ğŸ  ADMIN</a>
    </div>
</div>

<div class="grid-prehled">
    <div class="box box-trzby">
        <span id="sum-trzby" class="castka">0 KÄ</span>
        <span>MÄ›sÃ­ÄnÃ­ TrÅ¾by</span>
    </div>
    <div class="box box-naklady">
        <span id="sum-naklady" class="castka">0 KÄ</span>
        <span>MÄ›sÃ­ÄnÃ­ NÃ¡klady</span>
    </div>
    <div class="box box-zisk">
        <span id="sum-zisk" class="castka">0 KÄ</span>
        <span>ÄŒistÃ½ Zisk</span>
    </div>
</div>

<div class="sekce">
    <h3>â• PÅ™idat nÃ¡klad (tento mÄ›sÃ­c)</h3>
    <div class="form-naklad">
        <input type="text" id="naklad-nazev" placeholder="Popis (napÅ™. Nafta)" style="flex:2">
        <input type="number" id="naklad-cena" placeholder="KÄ" style="flex:1">
        <button class="btn-add" onclick="pridatNaklad()">ULOÅ½IT VÃDAJ</button>
    </div>
</div>

<div class="sekce">
    <h3>ğŸ“… RoÄnÃ­ pÅ™ehled <span id="label-rok"></span></h3>
    <table>
        <thead>
            <tr>
                <th>MÄ›sÃ­c</th>
                <th>TrÅ¾by</th>
                <th>NÃ¡klady</th>
                <th>Zisk</th>
            </tr>
        </thead>
        <tbody id="tabulka-rok">
            </tbody>
    </table>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const nazvyMesicu = ["Leden", "Ãšnor", "BÅ™ezen", "Duben", "KvÄ›ten", "ÄŒerven", "ÄŒervenec", "Srpen", "ZÃ¡Å™Ã­", "Å˜Ã­jen", "Listopad", "Prosinec"];

    function nactiData() {
        const rok = document.getElementById("select-rok").value;
        document.getElementById("label-rok").innerText = rok;
        const dnes = new Date();
        const aktualniMesicId = (dnes.getMonth() + 1);
        
        db.ref("finance").on("value", snap => {
            const data = snap.val() || {};
            let htmlRok = "";
            let celkemTrzbyMesic = 0;
            let celkemNakladyMesic = 0;

            for (let m = 1; m <= 12; m++) {
                const klic = m + "_" + rok;
                const mesicData = data[klic] || {};
                
                // VÃ½poÄet trÅ¾eb
                let trzby = 0;
                if (mesicData.trzby) {
                    Object.values(mesicData.trzby).forEach(t => trzby += parseInt(t.castka || 0));
                }

                // VÃ½poÄet nÃ¡kladÅ¯
                let naklady = 0;
                if (mesicData.vydaje) {
                    Object.values(mesicData.vydaje).forEach(v => naklady += parseInt(v.castka || 0));
                }

                const zisk = trzby - naklady;
                
                // Pokud je to aktuÃ¡lnÃ­ mÄ›sÃ­c, uloÅ¾Ã­me si ho do hornÃ­ch boxÅ¯
                if (m === aktualniMesicId && rok == dnes.getFullYear()) {
                    celkemTrzbyMesic = trzby;
                    celkemNakladyMesic = naklady;
                }

                htmlRok += `
                    <tr>
                        <td>${nazvyMesicu[m-1]}</td>
                        <td class="plus">${trzby} KÄ</td>
                        <td class="minus">${naklady} KÄ</td>
                        <td style="font-weight:bold; color:${zisk >= 0 ? 'green':'red'}">${zisk} KÄ</td>
                    </tr>`;
            }

            document.getElementById("tabulka-rok").innerHTML = htmlRok;
            document.getElementById("sum-trzby").innerText = celkemTrzbyMesic + " KÄ";
            document.getElementById("sum-naklady").innerText = celkemNakladyMesic + " KÄ";
            document.getElementById("sum-zisk").innerText = (celkemTrzbyMesic - celkemNakladyMesic) + " KÄ";
        });
    }

    function pridatNaklad() {
        const nazev = document.getElementById("naklad-nazev").value;
        const castka = document.getElementById("naklad-cena").value;
        if (!nazev || !castka) return;

        const dnes = new Date();
        const klic = (dnes.getMonth() + 1) + "_" + dnes.getFullYear();

        db.ref("finance/" + klic + "/vydaje").push({
            popis: nazev,
            castka: parseInt(castka),
            datum: dnes.toLocaleDateString()
        }).then(() => {
            document.getElementById("naklad-nazev").value = "";
            document.getElementById("naklad-cena").value = "";
        });
    }

    nactiData();
</script>
</body>
</html>
