function potvrditVydano(jm) {
    console.log("Spouštím potvrzení pro:", jm);

    db.ref("objednavky").once("value", (snap) => {
        const data = snap.val();
        let celkovaCastka = 0;
        let seznamZbozi = [];
        let kAktualizaci = [];

        for (let produkt in data) {
            for (let id in data[produkt]) {
                const obj = data[produkt][id];
                if (obj.zakaznik === jm && !obj.vydano) {
                    const cenaKg = cenyProduktu[produkt] || 0;
                    const vaha = obj.skutecna_vaha_gr || 0;
                    const cena = Math.round((vaha / 1000) * cenaKg);
                    
                    if (vaha > 0) {
                        celkovaCastka += cena;
                        seznamZbozi.push(produkt + " (" + vaha + "g)");
                        kAktualizaci.push({p: produkt, i: id});
                    }
                }
            }
        }

        if (kAktualizaci.length === 0) {
            alert("Chyba: Nebyly nalezeny žádné položky s vyplněnou váhou u jména: " + jm);
            return;
        }

        // ZÁPIS DO DATABÁZE
        const novaPlatba = {
            jmeno: jm,
            castka: celkovaCastka,
            zbozi: seznamZbozi.join(", "),
            datum: new Date().toLocaleDateString(),
            stav: "vydano_nezaplaceno"
        };

        db.ref("nezaplaceno").push(novaPlatba)
            .then(() => {
                console.log("Zápis do 'nezaplaceno' úspěšný");
                
                // Označit jako vydané v původních objednávkách
                let sliby = kAktualizaci.map(item => {
                    return db.ref("objednavky/" + item.p + "/" + item.i).update({ vydano: true });
                });

                return Promise.all(sliby);
            })
            .then(() => {
                alert("ÚSPĚŠNĚ ULOŽENO!\nZákazník: " + jm + "\nČástka: " + celkovaCastka + " Kč");
            })
            .catch((error) => {
                alert("CHYBA DATABÁZE: " + error.message);
                console.error(error);
            });
    });
}
