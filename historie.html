<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Historie & Bilance Solo</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #1a237e; --bg: #f4f7f9; --klobasa: #2e7d32; --cabajka: #1565c0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        .top-panel { display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px; }
        .bilance-box { 
            background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            flex-grow: 1; display: flex; flex-wrap: wrap; gap: 10px; 
        }

        /* Styl pro rozdƒõlen√© solo produkty */
        .bilance-item { 
            padding: 10px 18px; border-radius: 25px; font-weight: bold; 
            display: flex; align-items: center; gap: 10px; border: 2px solid #ddd;
            font-size: 1.1rem;
        }
        .barva-klobasa { background: #e8f5e9; color: var(--klobasa); border-color: var(--klobasa); }
        .barva-cabajka { background: #e3f2fd; color: var(--cabajka); border-color: var(--cabajka); }
        .barva-ostatni { background: #f5f5f5; color: #616161; border-color: #9e9e9e; }
        
        .badge { background: white; padding: 2px 10px; border-radius: 12px; box-shadow: inset 0 0 5px rgba(0,0,0,0.1); }

        .zakaznik-karta { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .historie-tabulka { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .historie-tabulka td { padding: 8px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0">üìä BILANCE SOLO PRODUKT≈Æ</h2>
    <a href="admin.html" style="text-decoration:none; font-weight:bold; color:var(--primary);">üè† ADMIN</a>
</div>

<div class="top-panel">
    <div id="bilance-zbozi" class="bilance-box">Poƒç√≠t√°m solo produkty...</div>
</div>

<div id="seznam-historie"></div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref("finance").on("value", snap => {
        const data = snap.val() || {};
        const zakaznici = {};
        const bilanceSolo = {}; 

        for (let mesic in data) {
            if (data[mesic].trzby) {
                for (let id in data[mesic].trzby) {
                    const t = data[mesic].trzby[id];
                    
                    // KL√çƒåOV√Å ZMƒöNA: Rozdƒõlen√≠ ≈ôetƒõzce podle ƒç√°rky
                    if (t.zbozi) {
                        const produktyVSeznamu = t.zbozi.split(","); 
                        
                        produktyVSeznamu.forEach(soloProdukt => {
                            const cistyNazev = soloProdukt.trim(); // Odstran√≠ mezery kolem
                            if (cistyNazev !== "") {
                                bilanceSolo[cistyNazev] = (bilanceSolo[cistyNazev] || 0) + 1;
                            }
                        });
                    }

                    if (!zakaznici[t.zakaznik]) zakaznici[t.zakaznik] = [];
                    zakaznici[t.zakaznik].push({...t, id, mesic});
                }
            }
        }
        vykresliBilanci(bilanceSolo);
        vykresliHistorii(zakaznici);
    });

    function vykresliBilanci(bilance) {
        const box = document.getElementById("bilance-zbozi");
        box.innerHTML = "";

        Object.keys(bilance).sort().forEach(nazev => {
            let trida = "barva-ostatni";
            const hledej = nazev.toLowerCase();

            if (hledej.includes("klobasa") || hledej.includes("klob√°sa")) trida = "barva-klobasa";
            if (hledej.includes("ƒçabajka") || hledej.includes("cabajka")) trida = "barva-cabajka";

            box.innerHTML += `
                <div class="bilance-item ${trida}">
                    ${nazev} <span class="badge">${bilance[nazev]}x</span>
                </div>`;
        });
    }

    function vykresliHistorii(zakaznici) {
        const kontejner = document.getElementById("seznam-historie");
        kontejner.innerHTML = "";
        Object.keys(zakaznici).sort().forEach(jmeno => {
            let radky = zakaznici[jmeno].reverse().map(n => 
                `<tr><td>${n.datum}</td><td>${n.zbozi}</td><td><b>${n.castka} Kƒç</b></td></tr>`
            ).join("");

            kontejner.innerHTML += `
                <div class="zakaznik-karta">
                    <div style="font-weight:bold; font-size:1.2rem; color:var(--primary);">${jmeno}</div>
                    <table class="historie-tabulka"><tbody>${radky}</tbody></table>
                </div>`;
        });
    }
</script>
</body>
</html>
