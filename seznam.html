<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>WhatsApp Rozes√≠latel</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 550px; }
        h2 { color: #1a237e; margin-top: 0; display: flex; align-items: center; gap: 10px; }
        
        .global-box { background: #e7f3ff; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #bbdefb; }
        textarea { width: 100%; height: 80px; border: 1px solid #ccc; border-radius: 8px; padding: 10px; box-sizing: border-box; resize: none; font-size: 1rem; }
        
        .zakaznik-radek { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; gap: 10px; }
        .jmeno { font-weight: bold; flex: 1; min-width: 100px; }
        .tel-input { width: 130px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }
        
        .btn-wa { background: #25D366; color: white; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; font-weight: bold; transition: 0.2s; }
        .btn-wa:hover { background: #128C7E; transform: scale(1.05); }
    </style>
</head>
<body>

<div class="container">
    <h2>üü¢ WhatsApp Seznam</h2>
    
    <div class="global-box">
        <label><b>Spoleƒçn√° zpr√°va:</b></label>
        <textarea id="msg" placeholder="Ahoj, zbo≈æ√≠ je p≈ôipraveno k odbƒõru!"></textarea>
    </div>

    <div id="list">Naƒç√≠t√°m jm√©na z objedn√°vek...</div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Naƒçten√≠ jmen z vƒõtvƒõ objedn√°vky
    db.ref("objednavky").on("value", snap => {
        const data = snap.val() || {};
        const lide = new Set(); // Set zajist√≠, ≈æe jm√©no bude jen jednou

        for (let produkt in data) {
            for (let id in data[produkt]) {
                if (data[produkt][id].zakaznik) {
                    lide.add(data[produkt][id].zakaznik);
                }
            }
        }
        vykresli(Array.from(lide).sort());
    });

    function vykresli(seznam) {
        const kontejner = document.getElementById("list");
        kontejner.innerHTML = "";
        
        seznam.forEach(jmeno => {
            // Vytvo≈ô√≠me bezpeƒçn√© ID pro input (bez mezer)
            const idInputu = "tel-" + jmeno.replace(/\s+/g, '-');
            
            kontejner.innerHTML += `
                <div class="zakaznik-radek">
                    <span class="jmeno">${jmeno}</span>
                    <input type="text" id="${idInputu}" class="tel-input" placeholder="777123456">
                    <button class="btn-wa" onclick="poslat('${idInputu}')">ODESLAT</button>
                </div>`;
        });
    }

    function poslat(idInputu) {
        const tel = document.getElementById(idInputu).value.replace(/\s+/g, '');
        const zprava = document.getElementById("msg").value;

        if (!tel) { alert("Dopl≈à telefonn√≠ ƒç√≠slo!"); return; }
        if (!zprava) { alert("Napi≈° text zpr√°vy!"); return; }

        // P≈ôid√°n√≠ ƒçesk√© p≈ôedvolby, pokud chyb√≠
        let cisteCislo = tel;
        if (cisteCislo.length === 9) cisteCislo = "420" + cisteCislo;
        if (cisteCislo.startsWith("+")) cisteCislo = cisteCislo.substring(1);

        const url = `https://wa.me/${cisteCislo}?text=${encodeURIComponent(zprava)}`;
        window.open(url, '_blank');
    }
</script>
</body>
</html>
