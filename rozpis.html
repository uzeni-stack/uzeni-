<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOS - 칔캛ETNICTV칈</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 10px; }
        .box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #455a64; }
        .prijem { color: green; font-weight: bold; font-size: 1.2em; }
        .vydaj { color: red; font-weight: bold; font-size: 1.2em; }
        .zisk { font-size: 1.5em; font-weight: bold; background: #ffff00; padding: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .btn-save { background: green; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div style="max-width: 800px; margin: auto;">
    <h1 style="text-align:center;">游늵 MOJE 칔캛ETNICTV칈</h1>

    <div class="box" style="background: #e0f7fa;">
        <h3>游눯 EKONOMIKA ROKU</h3>
        <p>CELKOV칄 TR콯BY: <span id="stat-trzby" class="prijem">0 K캜</span></p>
        <p>CELKOV칄 N츼KLADY: <span id="stat-naklady" class="vydaj">0 K캜</span></p>
        <p>캛IST칗 ZISK: <span id="stat-zisk" class="zisk">0 K캜</span></p>
        
        <hr>
        <h4>ZAPSAT NOV칗 N츼KLAD (maso, d콏evo...):</h4>
        <input type="number" id="novy-naklad" placeholder="캛치stka v K캜">
        <button onclick="pridejNaklad()" style="padding: 5px 10px;">ULO콯IT N츼KLAD</button>
    </div>

    <div id="vypis-sumar-lidi"></div>
    <div id="vypis-zbozi-vaha"></div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Na캜칤t치n칤 statistik a n치klad콢
    db.ref("statistiky").on("value", (snap) => {
        const s = snap.val() || {};
        const trzby = s.celkove_trzby || 0;
        const naklady = s.celkove_naklady || 0;
        document.getElementById("stat-trzby").innerText = trzby + " K캜";
        document.getElementById("stat-naklady").innerText = naklady + " K캜";
        document.getElementById("stat-zisk").innerText = (trzby - naklady) + " K캜";
    });

    // Na캜칤t치n칤 objedn치vek k v치쬰n칤
    db.ref("objednavky").on("value", (snap) => {
        const data = snap.val();
        const div = document.getElementById("vypis-zbozi-vaha");
        if (!data) { div.innerHTML = "콯치dn칠 objedn치vky."; return; }
        
        div.innerHTML = "<h3>游닍 V츼콯EN칈 ZBO콯칈</h3>";
        for (let id in data) {
            let o = data[id];
            div.innerHTML += `
                <div class="box">
                    <b>${o.zakaznik}</b> - ${o.produkty} (${o.vaha}kg)<br><br>
                    V치ha (gr): <input type="number" id="gr-${id}" value="${o.skutecna_vaha_gr || ''}" style="width:60px;"> 
                    Dostal: <input type="number" id="pay-${id}" value="${o.zaplaceno || 0}" style="width:60px;"> K캜 
                    <button class="btn-save" onclick="uloz('${id}')">ULO콯IT</button>
                </div>`;
        }
    });

    function uloz(id) {
        const gr = parseInt(document.getElementById("gr-"+id).value) || 0;
        const pay = parseInt(document.getElementById("pay-"+id).value) || 0;
        
        db.ref("objednavky/" + id).once("value").then((snap) => {
            const staraTrzba = snap.val().zaplaceno || 0;
            const rozdil = pay - staraTrzba;

            // Ulo쮂셠e k objedn치vce
            db.ref("objednavky/" + id).update({ skutecna_vaha_gr: gr, zaplaceno: pay });
            
            // P콏i캜teme do trval칳ch tr쬰b
            if (rozdil !== 0) {
                db.ref("statistiky/celkove_trzby").transaction(c => (c || 0) + rozdil);
            }
            alert("Ulo쬰no do 칰캜etnictv칤!");
        });
    }

    function pridejNaklad() {
        const castka = parseInt(document.getElementById("novy-naklad").value) || 0;
        if (castka > 0) {
            db.ref("statistiky/celkove_naklady").transaction(c => (c || 0) + castka);
            document.getElementById("novy-naklad").value = "";
            alert("N치klad zaps치n!");
        }
    }
</script>
</body>
</html>
