<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokladna Boos - E-shop</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 10px; margin: 0; }
        .container { max-width: 600px; margin: auto; }
        
        /* Horn√≠ navigace pro tebe */
        .admin-nav { background: #333; padding: 10px; text-align: center; border-radius: 10px; margin-bottom: 15px; }
        .admin-nav a { color: white; margin: 0 15px; text-decoration: none; font-weight: bold; font-size: 0.9em; }

        /* Tv≈Øj klasick√Ω styl sekce */
        .zbozi-sekce { background: white; margin-bottom: 20px; border-radius: 12px; border: 1px solid #1976d2; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .zbozi-hlavicka { background: #1976d2; color: white; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        
        table { width: 100%; border-collapse: collapse; background: white; }
        td, th { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        
        /* Ko≈°√≠k - tv≈Øj Sum√°≈ô box styl */
        .kosik-box { background: #e8f5e9; border: 2px solid #2e7d32; border-radius: 15px; padding: 15px; margin-top: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .input-text { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #1976d2; border-radius: 5px; box-sizing: border-box; font-size: 1em; }
        .btn-add { background: #1976d2; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-send { background: #2e7d32; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1em; }
        
        .setup-box { background: #cfd8dc; border: 2px solid #455a64; border-radius: 15px; padding: 15px; margin-top: 40px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <nav class="admin-nav">
        <a href="rozpis.html">‚öñÔ∏è V√Å≈ΩEN√ç</a>
        <a href="finance.html">üí∞ FINANCE</a>
    </nav>

    <h2 style="text-align:center;">üõí OBJEDN√ÅVKA UZENIN</h2>

    <div class="zbozi-sekce">
        <div class="zbozi-hlavicka"><span>üì¶ AKTU√ÅLN√ç NAB√çDKA</span><span>Cena za kg</span></div>
        <table id="tabulka-nabidky">
            <tr><td colspan="3" style="text-align:center;">Naƒç√≠t√°m produkty...</td></tr>
        </table>
    </div>

    <div class="kosik-box">
        <h3 style="margin-top:0; color:#2e7d32;">üõçÔ∏è V√Å≈† KO≈†√çK</h3>
        <div id="obsah-kosiku" style="margin-bottom: 15px;">Ko≈°√≠k je pr√°zdn√Ω</div>
        
        <input type="text" id="zakaznik-jmeno" class="input-text" placeholder="Zadejte Va≈°e jm√©no">
        <button class="btn-send" onclick="odeslatObjednavku()">POTVRDIT A ODESLAT</button>
    </div>

    <div class="setup-box">
        <h3 style="margin-top:0;">‚öôÔ∏è NASTAVEN√ç NAB√çDKY</h3>
        <input type="text" id="admin-nazev" placeholder="N√°zev zbo≈æ√≠" style="width:150px; padding:5px;">
        <input type="number" id="admin-cena" placeholder="Kƒç/kg" style="width:80px; padding:5px;">
        <button onclick="pridatProdukt()">P≈òIDAT</button>
        <div id="admin-list" style="margin-top:10px; font-style:italic;"></div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let kosik = [];

    // Naƒç√≠t√°n√≠ produkt≈Ø
    db.ref("produkty").on("value", (snap) => {
        const produkty = snap.val() || {};
        const tabulka = document.getElementById("tabulka-nabidky");
        const adminList = document.getElementById("admin-list");
        
        tabulka.innerHTML = "";
        adminList.innerHTML = "Smazat z nab√≠dky: ";
        
        for (let nazev in produkty) {
            // Tabulka pro z√°kazn√≠ky
            let tr = document.createElement("tr");
            tr.innerHTML = `
                <td><b>${nazev}</b></td>
                <td>${produkty[nazev]} Kƒç</td>
                <td style="text-align:right;"><button class="btn-add" onclick="pridatDoKosiku('${nazev}')">+ 0.5 kg</button></td>
            `;
            tabulka.appendChild(tr);
            
            // Seznam pro smaz√°n√≠ v adminu
            adminList.innerHTML += `<button onclick="smazatProdukt('${nazev}')" style="margin-right:10px; cursor:pointer;">${nazev} [x]</button>`;
        }
    });

    // Funkce Boos - Spr√°va
    function pridatProdukt() {
        const n = document.getElementById("admin-nazev").value;
        const p = document.getElementById("admin-cena").value;
        if(n && p) {
            db.ref("produkty/" + n).set(parseInt(p));
            document.getElementById("admin-nazev").value = "";
            document.getElementById("admin-cena").value = "";
        }
    }

    function smazatProdukt(n) {
        if(confirm("Odstranit " + n + " z nab√≠dky?")) db.ref("produkty/" + n).remove();
    }

    // Funkce Ko≈°√≠k
    function pridatDoKosiku(nazev) {
        let index = kosik.findIndex(item => item.nazev === nazev);
        if (index > -1) { kosik[index].vaha += 0.5; } 
        else { kosik.push({ nazev: nazev, vaha: 0.5 }); }
        vykresliKosik();
    }

    function vykresliKosik() {
        const div = document.getElementById("obsah-kosiku");
        if (kosik.length === 0) { div.innerHTML = "Ko≈°√≠k je pr√°zdn√Ω"; return; }
        
        let h = "<table style='background:none;'>";
        kosik.forEach((item, i) => {
            h += `<tr><td>${item.nazev}</td><td><b>${item.vaha} kg</b></td>
                  <td style="text-align:right;"><button onclick="odebrat(${i})" style="color:red; background:none; border:none; cursor:pointer;">zru≈°it</button></td></tr>`;
        });
        div.innerHTML = h + "</table>";
    }

    function odebrat(i) {
        kosik.splice(i, 1);
        vykresliKosik();
    }

    function odeslatObjednavku() {
        const jmeno = document.getElementById("zakaznik-jmeno").value;
        if (!jmeno || kosik.length === 0) { alert("Zadejte jm√©no a vyberte zbo≈æ√≠!"); return; }

        kosik.forEach(polozka => {
            db.ref("objednavky").push({
                zakaznik: jmeno, produkty: polozka.nazev, vaha: polozka.vaha,
                skutecna_vaha_gr: 0, skutecna_cena: 0, zaplaceno: 0
            });
        });

        alert("Dƒõkujeme! Objedn√°vka odesl√°na.");
        kosik = []; document.getElementById("zakaznik-jmeno").value = ""; vykresliKosik();
    }
</script>
</body>
</html>
