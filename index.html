<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dom치c칤 Uzeniny - E-shop</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; padding-bottom: 100px; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        
        header { background: #d32f2f; color: white; padding: 20px; text-align: center; border-radius: 0 0 20px 20px; margin-bottom: 20px; }
        
        .produkt-karta { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .produkt-info h3 { margin: 0; font-size: 1.1em; }
        .produkt-info span { color: #d32f2f; font-weight: bold; font-size: 0.9em; }

        .ovladani { display: flex; align-items: center; gap: 10px; }
        input[type="number"] { width: 60px; padding: 8px; border: 1px solid #ccc; border-radius: 5px; text-align: center; }
        .btn-pridat { background: #2e7d32; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* Plovouc칤 ko코칤k dole */
        .kosik-lista { position: fixed; bottom: 0; left: 0; right: 0; background: white; box-shadow: 0 -5px 15px rgba(0,0,0,0.2); padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .kosik-info { line-height: 1.2; }
        .btn-odeslat { background: #d32f2f; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Modal (okno) ko코칤ku */
        #modal-kosik { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
        .modal-obsah { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; }
        .polozka-kosiku { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 10px 0; }
    </style>
</head>
<body>

<header>
    <h1>游볼 UZEN츼콎STV칈</h1>
    <p>Vyberte si dobroty z na코칤 ud칤rny</p>
</header>

<div class="container" id="seznam-produktu">
    </div>

<div class="kosik-lista">
    <div class="kosik-info">
        <span id="kosik-pocet">V ko코칤ku: 0 polo쬰k</span><br>
        <strong id="kosik-celkem" style="color:#d32f2f; font-size: 1.2em;">0 K캜</strong>
    </div>
    <button class="btn-odeslat" onclick="otevritKosik()">PROHL칄DNOUT KO먞껢</button>
</div>

<div id="modal-kosik">
    <div class="modal-obsah">
        <h2 style="margin-top:0;">Va코e objedn치vka</h2>
        <div id="rekapitulace"></div>
        <hr>
        <input type="text" id="zakaznik-jmeno" placeholder="Va코e jm칠no a p콏칤jmen칤" style="width:100%; padding:12px; box-sizing:border-box; margin: 10px 0; border: 2px solid #d32f2f; border-radius: 8px;">
        <button class="btn-odeslat" style="width:100%;" onclick="odeslatVse()">POTVRDIT A ODESLAT</button>
        <button onclick="zavritKosik()" style="width:100%; background:none; border:none; color:#666; margin-top:10px; cursor:pointer;">Zp캩t k n치kupu</button>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let produktyData = {};
    let kosik = [];

    // 1. Na캜ten칤 produkt콢 z Adminu
    db.ref("produkty").on("value", (snap) => {
        produktyData = snap.val() || {};
        const div = document.getElementById("seznam-produktu");
        div.innerHTML = "";
        
        for (let nazev in produktyData) {
            const cena = produktyData[nazev];
            div.innerHTML += `
                <div class="produkt-karta">
                    <div class="produkt-info">
                        <h3>${nazev}</h3>
                        <span>${cena} K캜/kg</span>
                    </div>
                    <div class="ovladani">
                        <input type="number" id="qty-${nazev}" value="1.0" step="0.1" min="0.1">
                        <button class="btn-pridat" onclick="pridatDoKosiku('${nazev}', ${cena})">P콎IDAT</button>
                    </div>
                </div>`;
        }
    });

    function pridatDoKosiku(nazev, cena) {
        const vaha = parseFloat(document.getElementById("qty-" + nazev).value);
        if (vaha <= 0) return;
        
        kosik.push({ nazev, cena, vaha });
        aktualizovatListu();
        alert(nazev + " p콏id치n do ko코칤ku!");
    }

    function aktualizovatListu() {
        const pocet = kosik.length;
        const celkem = kosik.reduce((sum, item) => sum + (item.cena * item.vaha), 0);
        document.getElementById("kosik-pocet").innerText = "V ko코칤ku: " + pocet + " polo쬰k";
        document.getElementById("kosik-celkem").innerText = Math.round(celkem) + " K캜";
    }

    function otevritKosik() {
        if (kosik.length === 0) { alert("Ko코칤k je pr치zdn칳!"); return; }
        const div = document.getElementById("rekapitulace");
        div.innerHTML = "";
        kosik.forEach((item, index) => {
            div.innerHTML += `
                <div class="polozka-kosiku">
                    <span>${item.nazev} (${item.vaha} kg)</span>
                    <strong>${Math.round(item.vaha * item.cena)} K캜</strong>
                </div>`;
        });
        document.getElementById("modal-kosik").style.display = "flex";
    }

    function zavritKosik() {
        document.getElementById("modal-kosik").style.display = "none";
    }

    function odeslatVse() {
        const jmeno = document.getElementById("zakaznik-jmeno").value.trim();
        if (!jmeno) { alert("Zadejte pros칤m sv칠 jm칠no!"); return; }

        const datum = new Date().toLocaleString();

        // Tady se d캩je to kouzlo: Ka쬯치 polo쬶a z ko코칤ku jde do sv칠ho 코upl칤ku
        const sliby = kosik.map(polozka => {
            return db.ref("objednavky/" + polozka.nazev).push({
                zakaznik: jmeno,
                vaha_objednano: polozka.vaha,
                skutecna_vaha_gr: 0,
                zaplaceno: 0,
                datum: datum
            });
        });

        Promise.all(sliby).then(() => {
            alert("Objedn치vka byla 칰sp캩코n캩 odesl치na! D캩kujeme.");
            kosik = [];
            aktualizovatListu();
            zavritKosik();
            document.getElementById("zakaznik-jmeno").value = "";
        });
    }
</script>

</body>
</html>
