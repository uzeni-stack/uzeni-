<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dom√°c√≠ Uzeniny - Objedn√°vka</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; padding-bottom: 120px; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        
        header { background: #d32f2f; color: white; padding: 25px 15px; text-align: center; border-radius: 0 0 25px 25px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        header h1 { margin: 0; font-size: 1.8em; }

        .produkt-karta { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 15px; display: flex; flex-direction: column; gap: 15px; border: 1px solid #eee; }
        .info-radek { display: flex; justify-content: space-between; align-items: center; }
        .nazev { font-size: 1.2em; font-weight: bold; margin: 0; }
        .cena { color: #d32f2f; font-weight: bold; font-size: 1.1em; }

        .akce-radek { display: flex; gap: 10px; align-items: center; }
        input[type="number"] { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; text-align: center; }
        .btn-pridat { background: #2e7d32; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 2; }

        /* FIXN√ç KO≈†√çK DOLE */
        .kosik-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #fff; box-shadow: 0 -5px 20px rgba(0,0,0,0.15); 
            padding: 20px; display: flex; justify-content: space-between; align-items: center; 
            z-index: 9999; border-top: 3px solid #d32f2f;
        }
        .kosik-text { line-height: 1.4; }
        .kosik-text b { color: #d32f2f; font-size: 1.3em; }
        .btn-otevrit { background: #d32f2f; color: white; border: none; padding: 15px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1em; }

        /* MODAL OKNO */
        #modal-kosik { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; justify-content: center; align-items: center; padding: 15px; box-sizing: border-box; }
        .modal-obsah { background: white; padding: 25px; border-radius: 20px; width: 100%; max-width: 450px; max-height: 80vh; overflow-y: auto; }
        .polozka { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .btn-odeslat { background: #d32f2f; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1.1em; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <h1>ü•© DOM√ÅC√ç UZEN√Å≈ò</h1>
    <p>Poctiv√© maso p≈ô√≠mo z ud√≠rny</p>
</header>

<div class="container" id="nabidka-list">
    <p style="text-align:center; color:#888;">Naƒç√≠t√°m dobroty...</p>
</div>

<div class="kosik-bar" id="kosik-lista" style="display:none;">
    <div class="kosik-text">
        <span id="pocet-polozek">Polo≈æek: 0</span><br>
        <b id="celkova-cena">0 Kƒç</b>
    </div>
    <button class="btn-otevrit" onclick="ukazKosik()">DOKONƒåIT N√ÅKUP</button>
</div>

<div id="modal-kosik">
    <div class="modal-obsah">
        <h2 style="margin-top:0;">V√°≈° ko≈°√≠k</h2>
        <div id="rekapitulace"></div>
        <div style="margin-top:20px;">
            <label style="font-weight:bold; font-size:0.9em;">VA≈†E JM√âNO:</label>
            <input type="text" id="jmeno-zakaznika" placeholder="Jm√©no a p≈ô√≠jmen√≠" style="width:100%; padding:12px; margin-top:5px; border:2px solid #ddd; border-radius:8px; box-sizing:border-box;">
        </div>
        <button class="btn-odeslat" onclick="odeslatObjednavku()">ODESLAT OBJEDN√ÅVKU</button>
        <button onclick="skryjKosik()" style="width:100%; background:none; border:none; color:#666; margin-top:15px; cursor:pointer;">Zav≈ô√≠t a p≈ôidat dal≈°√≠</button>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let kosik = [];
    let cenyZbozi = {};

    // Naƒçten√≠ produkt≈Ø
    db.ref("produkty").on("value", (snap) => {
        const produkty = snap.val() || {};
        cenyZbozi = produkty;
        const list = document.getElementById("nabidka-list");
        list.innerHTML = "";

        for (let nazev in produkty) {
            const cena = produkty[nazev];
            const div = document.createElement("div");
            div.className = "produkt-karta";
            div.innerHTML = `
                <div class="info-radek">
                    <span class="nazev">${nazev}</span>
                    <span class="cena">${cena} Kƒç/kg</span>
                </div>
                <div class="akce-radek">
                    <input type="number" id="q-${nazev}" value="1.0" step="0.1" min="0.1">
                    <button class="btn-pridat" onclick="doKosiku('${nazev}')">P≈òIDAT</button>
                </div>
            `;
            list.appendChild(div);
        }
    });

    function doKosiku(nazev) {
        const vaha = parseFloat(document.getElementById("q-" + nazev).value);
        if (vaha > 0) {
            kosik.push({ nazev: nazev, vaha: vaha, cena: cenyZbozi[nazev] });
            prekresliListu();
            // Jemn√° animace tlaƒç√≠tka nebo potvrzen√≠
            const btn = event.target;
            btn.innerText = "P≈òID√ÅNO! ‚úÖ";
            setTimeout(() => { btn.innerText = "P≈òIDAT"; }, 1000);
        }
    }

    function prekresliListu() {
        const bar = document.getElementById("kosik-lista");
        if (kosik.length > 0) {
            bar.style.display = "flex";
            const celkem = kosik.reduce((s, i) => s + (i.vaha * i.cena), 0);
            document.getElementById("pocet-polozek").innerText = "Polo≈æek v ko≈°√≠ku: " + kosik.length;
            document.getElementById("celkova-cena").innerText = Math.round(celkem) + " Kƒç";
        } else {
            bar.style.display = "none";
        }
    }

    function ukazKosik() {
        const rek = document.getElementById("rekapitulace");
        rek.innerHTML = "";
        kosik.forEach((item, index) => {
            rek.innerHTML += `
                <div class="polozka">
                    <span>${item.nazev} (${item.vaha} kg)</span>
                    <b>${Math.round(item.vaha * item.cena)} Kƒç</b>
                </div>
            `;
        });
        document.getElementById("modal-kosik").style.display = "flex";
    }

    function skryjKosik() {
        document.getElementById("modal-kosik").style.display = "none";
    }

    function odeslatObjednavku() {
        const jmeno = document.getElementById("jmeno-zakaznika").value.trim();
        if (!jmeno) { alert("Pros√≠m vypl≈àte sv√© jm√©no."); return; }

        const datum = new Date().toLocaleString();
        
        // Ulo≈æen√≠ ka≈æd√© polo≈æky do jej√≠ho listu
        const zapisy = kosik.map(p => {
            return db.ref("objednavky/" + p.nazev).push({
                zakaznik: jmeno,
                vaha_objednano: p.vaha,
                skutecna_vaha_gr: 0,
                zaplaceno: 0,
                datum: datum
            });
        });

        Promise.all(zapisy).then(() => {
            alert("Dƒõkujeme! Objedn√°vka odesl√°na.");
            kosik = [];
            prekresliListu();
            skryjKosik();
            document.getElementById("jmeno-zakaznika").value = "";
        });
    }
</script>

</body>
</html>
