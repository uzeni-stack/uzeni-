<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-shop - Objedn√°vka</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: auto; }
        
        header { text-align: center; padding: 10px; color: #d32f2f; }

        /* SEKCE KO≈†√çKU NAHO≈òE */
        .kosik-sekce { 
            background: white; border-radius: 15px; padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 30px; 
            border: 2px solid #d32f2f; display: none; /* Schov√°me, dokud je pr√°zdn√Ω */
        }
        .kosik-sekce h2 { margin-top: 0; font-size: 1.2em; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .polozka-v-kosiku { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f9f9f9; align-items: center; }
        .btn-smazat { color: #d32f2f; cursor: pointer; font-weight: bold; border: none; background: none; }

        .celkova-cena { text-align: right; font-size: 1.3em; font-weight: bold; margin-top: 15px; color: #d32f2f; }
        .zakaznik-box { margin-top: 15px; display: flex; flex-direction: column; gap: 10px; }
        .input-jmeno { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; }
        .btn-odeslat { background: #d32f2f; color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1em; }

        /* NAB√çDKA ZBO≈Ω√ç */
        .nadpis-nabidka { font-size: 1.1em; color: #666; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .karta { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .produkt-nazev { font-weight: bold; font-size: 1.1em; }
        .produkt-cena { color: #d32f2f; font-size: 0.9em; font-weight: bold; }
        
        .akce { display: flex; gap: 8px; align-items: center; }
        .vaha-input { width: 60px; padding: 8px; border: 1px solid #ccc; border-radius: 6px; text-align: center; font-weight: bold; }
        .btn-pridat { background: #2e7d32; color: white; border: none; padding: 10px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ü•© DOM√ÅC√ç DOBROTY</h1>
    </header>

    <div id="kosik-kontejner" class="kosik-sekce">
        <h2>V√°≈° n√°kupn√≠ l√≠stek</h2>
        <div id="kosik-seznam">
            </div>
        <div class="celkova-cena">Celkem: <span id="suma">0</span> Kƒç</div>
        
        <div class="zakaznik-box">
            <input type="text" id="jmeno" class="input-jmeno" placeholder="Va≈°e jm√©no a p≈ô√≠jmen√≠">
            <button class="btn-odeslat" onclick="odeslatObjednavku()">ODESLAT OBJEDN√ÅVKU</button>
        </div>
    </div>

    <div class="nadpis-nabidka">Aktu√°ln√≠ nab√≠dka zbo≈æ√≠:</div>
    <div id="nabidka">
        </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let kosik = [];
    let produktyCeny = {};

    // Naƒçten√≠ produkt≈Ø
    db.ref("produkty").on("value", (snap) => {
        const data = snap.val() || {};
        produktyCeny = data;
        const div = document.getElementById("nabidka");
        div.innerHTML = "";

        for (let nazev in data) {
            div.innerHTML += `
                <div class="karta">
                    <div>
                        <div class="produkt-nazev">${nazev}</div>
                        <div class="produkt-cena">${data[nazev]} Kƒç/kg</div>
                    </div>
                    <div class="akce">
                        <input type="number" step="0.1" value="1.0" class="vaha-input" id="vaha-${nazev}">
                        <button class="btn-pridat" onclick="pridatDoKosiku('${nazev}')">P≈òIDAT</button>
                    </div>
                </div>`;
        }
    });

    function pridatDoKosiku(nazev) {
        const vaha = parseFloat(document.getElementById("vaha-" + nazev).value);
        if (vaha <= 0) return;

        // Pokud u≈æ tam vƒõc je, jen p≈ôiƒçteme v√°hu
        const index = kosik.findIndex(p => p.nazev === nazev);
        if (index > -1) {
            kosik[index].vaha += vaha;
        } else {
            kosik.push({ nazev: nazev, vaha: vaha, cena: produktyCeny[nazev] });
        }
        prekresliKosik();
    }

    function smazatZKosiku(index) {
        kosik.splice(index, 1);
        prekresliKosik();
    }

    function prekresliKosik() {
        const kontejner = document.getElementById("kosik-kontejner");
        const seznam = document.getElementById("kosik-seznam");
        const sumaTxt = document.getElementById("suma");

        if (kosik.length === 0) {
            kontejner.style.display = "none";
            return;
        }

        kontejner.style.display = "block";
        seznam.innerHTML = "";
        let celkem = 0;

        kosik.forEach((item, i) => {
            const cenaPolozky = Math.round(item.vaha * item.cena);
            celkem += cenaPolozky;
            seznam.innerHTML += `
                <div class="polozka-v-kosiku">
                    <span><b>${item.nazev}</b> (${item.vaha} kg)</span>
                    <span>
                        ${cenaPolozky} Kƒç 
                        <button class="btn-smazat" onclick="smazatZKosiku(${i})">‚úï</button>
                    </span>
                </div>`;
        });
        sumaTxt.innerText = celkem;
        // Scroll nahoru, aby z√°kazn√≠k vidƒõl, ≈æe se to p≈ôidalo do ko≈°√≠ku
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function odeslatObjednavku() {
        const jmeno = document.getElementById("jmeno").value.trim();
        if (!jmeno) { alert("Zadejte jm√©no, pros√≠m."); return; }

        const datum = new Date().toLocaleString();
        const sliby = kosik.map(p => {
            return db.ref("objednavky/" + p.nazev).push({
                zakaznik: jmeno,
                vaha_objednano: p.vaha,
                skutecna_vaha_gr: 0,
                zaplaceno: 0,
                datum: datum
            });
        });

        Promise.all(sliby).then(() => {
            alert("Dƒõkujeme! Objedn√°vka byla odesl√°na.");
            kosik = [];
            document.getElementById("jmeno").value = "";
            prekresliKosik();
        });
    }
</script>

</body>
</html>
