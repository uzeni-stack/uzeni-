<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokladna Boos - E-shop</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 10px; margin: 0; }
        .container { max-width: 600px; margin: auto; }
        
        .admin-nav { background: #333; padding: 10px; text-align: center; border-radius: 10px; margin-bottom: 15px; }
        .admin-nav a { color: white; margin: 0 15px; text-decoration: none; font-weight: bold; font-size: 0.9em; }

        .zbozi-sekce { background: white; margin-bottom: 20px; border-radius: 12px; border: 1px solid #1976d2; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .zbozi-hlavicka { background: #1976d2; color: white; padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        
        table { width: 100%; border-collapse: collapse; background: white; }
        td, th { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        
        .kosik-box { background: #e8f5e9; border: 2px solid #2e7d32; border-radius: 15px; padding: 15px; margin-top: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .input-text { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #1976d2; border-radius: 5px; box-sizing: border-box; font-size: 1em; }
        .btn-add { background: #1976d2; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 5px; }
        .btn-remove { background: #f44336; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-send { background: #2e7d32; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1em; margin-top: 10px; }
        
        .setup-box { background: #cfd8dc; border: 2px solid #455a64; border-radius: 15px; padding: 15px; margin-top: 40px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <nav class="admin-nav">
        <a href="rozpis.html">‚öñÔ∏è V√Å≈ΩEN√ç</a>
        <a href="finance.html">üí∞ FINANCE</a>
    </nav>

    <h2 style="text-align:center;">üõí OBJEDN√ÅVKA UZENIN</h2>

    <div class="zbozi-sekce">
        <div class="zbozi-hlavicka"><span>üì¶ AKTU√ÅLN√ç NAB√çDKA</span><span>Cena za kg</span></div>
        <table id="tabulka-nabidky">
            <tr><td colspan="3" style="text-align:center;">Naƒç√≠t√°m produkty...</td></tr>
        </table>
    </div>

    <div class="kosik-box" id="kosik-sekce">
        <h3 style="margin-top:0; color:#2e7d32;">üõçÔ∏è V√Å≈† KO≈†√çK</h3>
        <div id="obsah-kosiku">Ko≈°√≠k je pr√°zdn√Ω. Kliknƒõte na tlaƒç√≠tko "P≈ôidat" u zbo≈æ√≠.</div>
        
        <div id="formular-odeslani" style="display:none; margin-top:15px; border-top:1px solid #2e7d32; padding-top:10px;">
            <input type="text" id="zakaznik-jmeno" class="input-text" placeholder="Va≈°e jm√©no a p≈ô√≠jmen√≠">
            <button class="btn-send" onclick="odeslatObjednavku()">POTVRDIT A ODESLAT DO UD√çRNY</button>
        </div>
    </div>

    <div class="setup-box">
        <h3 style="margin-top:0;">‚öôÔ∏è NASTAVEN√ç NAB√çDKY (Jen pro Boose)</h3>
        <input type="text" id="admin-nazev" placeholder="N√°zev zbo≈æ√≠" style="width:130px;">
        <input type="number" id="admin-cena" placeholder="Kƒç/kg" style="width:70px;">
        <button onclick="pridatProdukt()">P≈òIDAT</button>
        <div id="admin-list" style="margin-top:10px;"></div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://eshop-fh-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let kosik = {}; // Pou≈æijeme objekt pro snadnƒõj≈°√≠ sƒç√≠t√°n√≠ kg

    // Naƒç√≠t√°n√≠ produkt≈Ø z DB
    db.ref("produkty").on("value", (snap) => {
        const produkty = snap.val() || {};
        const tabulka = document.getElementById("tabulka-nabidky");
        const adminList = document.getElementById("admin-list");
        
        tabulka.innerHTML = "";
        adminList.innerHTML = "<b>Aktu√°lnƒõ nab√≠z√≠te:</b><br>";
        
        for (let nazev in produkty) {
            // Tabulka pro z√°kazn√≠ky
            let tr = document.createElement("tr");
            tr.innerHTML = `
                <td><b>${nazev}</b></td>
                <td>${produkty[nazev]} Kƒç</td>
                <td style="text-align:right;">
                    <button class="btn-add" onclick="upravitVahu('${nazev}', 0.5)">+ 0.5 kg</button>
                </td>
            `;
            tabulka.appendChild(tr);
            
            // Administrace
            adminList.innerHTML += `${nazev} (${produkty[nazev]} Kƒç) <button onclick="smazatProdukt('${nazev}')" style="color:red; cursor:pointer; margin-right:15px;">[x]</button> `;
        }
    });

    // Funkce pro zmƒõnu v√°hy v ko≈°√≠ku
    function upravitVahu(nazev, zmena) {
        if (!kosik[nazev]) kosik[nazev] = 0;
        kosik[nazev] += zmena;
        
        if (kosik[nazev] <= 0) delete kosik[nazev];
        
        vykresliKosik();
    }

    // Vykreslen√≠ ko≈°√≠ku
    function vykresliKosik() {
        const div = document.getElementById("obsah-kosiku");
        const form = document.getElementById("formular-odeslani");
        const klice = Object.keys(kosik);
        
        if (klice.length === 0) {
            div.innerHTML = "Ko≈°√≠k je pr√°zdn√Ω. Kliknƒõte na tlaƒç√≠tko '+ 0.5 kg' u zbo≈æ√≠.";
            form.style.display = "none";
            return;
        }
        
        form.style.display = "block";
        let h = "<table style='background:none; width:100%;'>";
        klice.forEach(nazev => {
            h += `<tr>
                    <td><b>${nazev}</b></td>
                    <td style="text-align:center;">
                        <button class="btn-remove" onclick="upravitVahu('${nazev}', -0.5)">-</button>
                        <span style="margin: 0 10px; font-weight:bold;">${kosik[nazev]} kg</span>
                        <button class="btn-add" onclick="upravitVahu('${nazev}', 0.5)">+</button>
                    </td>
                  </tr>`;
        });
        div.innerHTML = h + "</table>";
    }

    // Funkce Boos - P≈ôid√°n√≠ nov√©ho produktu do nab√≠dky
    function pridatProdukt() {
        const n = document.getElementById("admin-nazev").value;
        const p = document.getElementById("admin-cena").value;
        if(n && p) {
            db.ref("produkty/" + n).set(parseInt(p));
            document.getElementById("admin-nazev").value = "";
            document.getElementById("admin-cena").value = "";
        } else { alert("Vypl≈à n√°zev i cenu!"); }
    }

    function smazatProdukt(n) {
        if(confirm("Odstranit " + n + " z nab√≠dky?")) db.ref("produkty/" + n).remove();
    }

    // Odesl√°n√≠ objedn√°vky
    function odeslatObjednavku() {
        const jmeno = document.getElementById("zakaznik-jmeno").value;
        if (!jmeno) { alert("Zadejte pros√≠m Va≈°e jm√©no!"); return; }

        const klice = Object.keys(kosik);
        klice.forEach(nazev => {
            db.ref("objednavky").push({
                zakaznik: jmeno,
                produkty: nazev,
                vaha: kosik[nazev],
                skutecna_vaha_gr: 0,
                skutecna_cena: 0,
                zaplaceno: 0,
                datum: new Date().toLocaleDateString()
            });
        });

        alert("Dƒõkujeme! Va≈°e objedn√°vka byla odesl√°na k ud√≠rnƒõ.");
        kosik = {};
        document.getElementById("zakaznik-jmeno").value = "";
        vykresliKosik();
    }
</script>
</body>
</html>
